<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>MySQL 脚本生成器</title>
  <script src="./js/tailwind.js"></script>
</head>
<body class="bg-gray-50 min-h-screen flex flex-col items-center py-10">
  <h1 class="text-3xl font-bold text-blue-700 mb-8">MySQL 脚本生成器</h1>
  <form id="mysqlForm" class="bg-white shadow-lg rounded-xl p-8 flex flex-col gap-4 w-full max-w-md mb-8">
    <label class="flex flex-col gap-1 font-medium text-gray-700">磁盘盘符:
      <input name="disk" value="D" maxlength="1" required class="border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400" />
    </label>
    <label class="flex flex-col gap-1 font-medium text-gray-700">MySQL 版本:
      <input name="version" value="mysql-8.0.11-winx64" required class="border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400" />
    </label>
    <label class="flex flex-col gap-1 font-medium text-gray-700">root 密码:
      <input name="password" value="123456" required class="border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400" />
    </label>
    <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded py-2 mt-2 transition">生成脚本</button>
  </form>
  <div class="w-full max-w-2xl flex flex-col gap-6">
    <div>
      <h2 class="text-xl font-semibold text-gray-800 mb-2">my.ini 配置</h2>
      <textarea id="myini" rows="13" readonly class="w-full border border-gray-300 rounded p-3 font-mono bg-gray-100 resize-none"></textarea>
      <button id="download-ini" class="mt-2 bg-green-500 hover:bg-green-600 text-white rounded px-4 py-2 font-medium transition">下载 my.ini</button>
    </div>
    <div>
      <h2 class="text-xl font-semibold text-gray-800 mb-2">命令行脚本</h2>
      <textarea id="cmd" rows="18" readonly class="w-full border border-gray-300 rounded p-3 font-mono bg-gray-100 resize-none"></textarea>
      <div class="flex gap-3 mt-2">
        <button id="download-install-shortcut" class="bg-yellow-500 hover:bg-yellow-600 text-white rounded px-4 py-2 font-medium transition flex items-center">下载一键安装脚本</button>
        <button id="download-ico" class="bg-gray-700 hover:bg-gray-800 text-white rounded px-4 py-2 font-medium transition flex items-center">
          <img src="./img/mysqlico.ico" alt="icon" class="w-5 h-5 mr-2"> 下载图标
        </button>
      </div>
    </div>
  </div>
  <script type="module">
    import { myiniTemplates } from './templates/myini_templates.js';
    import { generateInstallAndShortcutBat } from './templates/shortcut_bat.js';

    function getVersionType(version) {
      const m3 = version.match(/(\d+\.\d+\.\d+)/);
      if (m3 && myiniTemplates[m3[1]]) return m3[1];
      const m2 = version.match(/(\d+\.\d+)/);
      if (m2 && myiniTemplates[m2[1]]) return m2[1];
      return '8.0';
    }

    document.getElementById('mysqlForm').onsubmit = function(e) {
      e.preventDefault();
      const f = Object.fromEntries(new FormData(this));
      const basedir = `${f.disk}:\\${f.version}`;
      const datadir = `${basedir}\\Data`;
      const versionType = getVersionType(f.version);
      let myini = myiniTemplates[versionType]
        .replace('{basedir}', basedir)
        .replace('{datadir}', datadir);
      document.getElementById('myini').value = myini;

      const bat = generateInstallAndShortcutBat(basedir, f.password);
      document.getElementById('cmd').value = bat;
    };

    document.getElementById('download-ini').onclick = () => {
      const blob = new Blob([document.getElementById('myini').value], {type: 'text/plain'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'my.ini';
      a.click();
    };
    document.getElementById('download-install-shortcut').onclick = () => {
      const disk = document.querySelector('[name="disk"]').value || 'D';
      const version = document.querySelector('[name="version"]').value || 'mysql-8.0.11-winx64';
      const password = document.querySelector('[name="password"]').value || '123456';
      const mysqlHome = `${disk}:\\${version}`;
      const bat = generateInstallAndShortcutBat(mysqlHome, password);
      const blob = new Blob([bat], {type: 'text/plain'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'mysql_install.bat';
      a.click();
    };
    document.getElementById('download-ico').onclick = () => {
      const a = document.createElement('a');
      a.href = './img/mysqlico.ico';
      a.download = 'mysqlico.ico';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    };
  </script>
</body>
</html> 